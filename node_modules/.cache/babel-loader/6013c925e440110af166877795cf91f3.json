{"ast":null,"code":"import _toConsumableArray from\"/Users/nguyenvanhuan243/Documents/apphocvienstock/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/Users/nguyenvanhuan243/Documents/apphocvienstock/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/nguyenvanhuan243/Documents/apphocvienstock/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/Users/nguyenvanhuan243/Documents/apphocvienstock/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";var _templateObject,_templateObject2,_templateObject3,_templateObject4,_templateObject5;import React,{useEffect,useMemo,useRef,useState}from'react';import{useLocation}from'react-router-dom';import styled from'styled-components';import BigNumber from'bignumber.js';import{useWeb3React}from'@web3-react/core';import{Heading,Flex,Image,Text}from'@pancakeswap/uikit';import orderBy from'lodash/orderBy';import partition from'lodash/partition';import{useTranslation}from'contexts/Localization';import usePersistState from'hooks/usePersistState';import{useFetchPublicPoolsData,usePools,useFetchCakeVault,useCakeVault}from'state/pools/hooks';import{usePollFarmsData}from'state/farms/hooks';import{latinise}from'utils/latinise';import FlexLayout from'components/Layout/Flex';import Page from'components/Layout/Page';import PageHeader from'components/PageHeader';import SearchInput from'components/SearchInput';import Select from'components/Select/Select';import Loading from'components/Loading';import PoolCard from'./components/PoolCard';import CakeVaultCard from'./components/CakeVaultCard';import PoolTabButtons from'./components/PoolTabButtons';import BountyCard from'./components/BountyCard';import HelpButton from'./components/HelpButton';import PoolsTable from'./components/PoolsTable/PoolsTable';import{ViewMode}from'./components/ToggleView/ToggleView';import{getAprData,getCakeVaultEarnings}from'./helpers';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var CardLayout=styled(FlexLayout)(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  justify-content: center;\\n\"])));var PoolControls=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  display: flex;\\n  width: 100%;\\n  align-items: center;\\n  position: relative;\\n\\n  justify-content: space-between;\\n  flex-direction: column;\\n  margin-bottom: 32px;\\n\\n  \",\" {\\n    flex-direction: row;\\n    flex-wrap: wrap;\\n    padding: 16px 32px;\\n    margin-bottom: 0;\\n  }\\n\"])),function(_ref){var theme=_ref.theme;return theme.mediaQueries.sm;});var FilterContainer=styled.div(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  display: flex;\\n  align-items: center;\\n  width: 100%;\\n  padding: 8px 0px;\\n\\n  \",\" {\\n    width: auto;\\n    padding: 0;\\n  }\\n\"])),function(_ref2){var theme=_ref2.theme;return theme.mediaQueries.sm;});var LabelWrapper=styled.div(_templateObject4||(_templateObject4=_taggedTemplateLiteral([\"\\n  > \",\" {\\n    font-size: 12px;\\n  }\\n\"])),Text);var ControlStretch=styled(Flex)(_templateObject5||(_templateObject5=_taggedTemplateLiteral([\"\\n  > div {\\n    flex: 1;\\n  }\\n\"])));var NUMBER_OF_POOLS_VISIBLE=12;var Pools=function Pools(){var location=useLocation();var _useTranslation=useTranslation(),t=_useTranslation.t;var _useWeb3React=useWeb3React(),account=_useWeb3React.account;var _usePools=usePools(account),poolsWithoutAutoVault=_usePools.pools,userDataLoaded=_usePools.userDataLoaded;var _usePersistState=usePersistState(false,{localStorageKey:'pancake_pool_staked'}),_usePersistState2=_slicedToArray(_usePersistState,2),stakedOnly=_usePersistState2[0],setStakedOnly=_usePersistState2[1];var _useState=useState(NUMBER_OF_POOLS_VISIBLE),_useState2=_slicedToArray(_useState,2),numberOfPoolsVisible=_useState2[0],setNumberOfPoolsVisible=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),observerIsSet=_useState4[0],setObserverIsSet=_useState4[1];var loadMoreRef=useRef(null);var _usePersistState3=usePersistState(ViewMode.TABLE,{localStorageKey:'pancake_pool_view'}),_usePersistState4=_slicedToArray(_usePersistState3,2),viewMode=_usePersistState4[0],setViewMode=_usePersistState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),searchQuery=_useState6[0],setSearchQuery=_useState6[1];var _useState7=useState('hot'),_useState8=_slicedToArray(_useState7,2),sortOption=_useState8[0],setSortOption=_useState8[1];var chosenPoolsLength=useRef(0);var _useCakeVault=useCakeVault(),_useCakeVault$userDat=_useCakeVault.userData,cakeAtLastUserAction=_useCakeVault$userDat.cakeAtLastUserAction,userShares=_useCakeVault$userDat.userShares,performanceFee=_useCakeVault.fees.performanceFee,pricePerFullShare=_useCakeVault.pricePerFullShare,totalCakeInVault=_useCakeVault.totalCakeInVault;var accountHasVaultShares=userShares&&userShares.gt(0);var performanceFeeAsDecimal=performanceFee&&performanceFee/100;var pools=useMemo(function(){var cakePool=poolsWithoutAutoVault.find(function(pool){return pool.sousId===0;});var cakeAutoVault=_objectSpread(_objectSpread({},cakePool),{},{isAutoVault:true});return[cakeAutoVault].concat(_toConsumableArray(poolsWithoutAutoVault));},[poolsWithoutAutoVault]);// TODO aren't arrays in dep array checked just by reference, i.e. it will rerender every time reference changes?\nvar _useMemo=useMemo(function(){return partition(pools,function(pool){return pool.isFinished;});},[pools]),_useMemo2=_slicedToArray(_useMemo,2),finishedPools=_useMemo2[0],openPools=_useMemo2[1];var stakedOnlyFinishedPools=useMemo(function(){return finishedPools.filter(function(pool){if(pool.isAutoVault){return accountHasVaultShares;}return pool.userData&&new BigNumber(pool.userData.stakedBalance).isGreaterThan(0);});},[finishedPools,accountHasVaultShares]);var stakedOnlyOpenPools=useMemo(function(){return openPools.filter(function(pool){if(pool.isAutoVault){return accountHasVaultShares;}return pool.userData&&new BigNumber(pool.userData.stakedBalance).isGreaterThan(0);});},[openPools,accountHasVaultShares]);var hasStakeInFinishedPools=stakedOnlyFinishedPools.length>0;usePollFarmsData();useFetchCakeVault();useFetchPublicPoolsData();useEffect(function(){var showMorePools=function showMorePools(entries){var _entries=_slicedToArray(entries,1),entry=_entries[0];if(entry.isIntersecting){setNumberOfPoolsVisible(function(poolsCurrentlyVisible){if(poolsCurrentlyVisible<=chosenPoolsLength.current){return poolsCurrentlyVisible+NUMBER_OF_POOLS_VISIBLE;}return poolsCurrentlyVisible;});}};if(!observerIsSet){var loadMoreObserver=new IntersectionObserver(showMorePools,{rootMargin:'0px',threshold:1});loadMoreObserver.observe(loadMoreRef.current);setObserverIsSet(true);}},[observerIsSet]);var showFinishedPools=location.pathname.includes('history');var handleChangeSearchQuery=function handleChangeSearchQuery(event){setSearchQuery(event.target.value);};var handleSortOptionChange=function handleSortOptionChange(option){setSortOption(option.value);};var sortPools=function sortPools(poolsToSort){switch(sortOption){case'apr':// Ternary is needed to prevent pools without APR (like MIX) getting top spot\nreturn orderBy(poolsToSort,function(pool){return pool.apr?getAprData(pool,performanceFeeAsDecimal).apr:0;},'desc');case'earned':return orderBy(poolsToSort,function(pool){if(!pool.userData||!pool.earningTokenPrice){return 0;}return pool.isAutoVault?getCakeVaultEarnings(account,cakeAtLastUserAction,userShares,pricePerFullShare,pool.earningTokenPrice).autoUsdToDisplay:pool.userData.pendingReward.times(pool.earningTokenPrice).toNumber();},'desc');case'totalStaked':return orderBy(poolsToSort,function(pool){return pool.isAutoVault?totalCakeInVault.toNumber():pool.totalStaked.toNumber();},'desc');default:return poolsToSort;}};var chosenPools;if(showFinishedPools){chosenPools=stakedOnly?stakedOnlyFinishedPools:finishedPools;}else{chosenPools=stakedOnly?stakedOnlyOpenPools:openPools;}if(searchQuery){var lowercaseQuery=latinise(searchQuery.toLowerCase());chosenPools=chosenPools.filter(function(pool){return latinise(pool.earningToken.symbol.toLowerCase()).includes(lowercaseQuery);});}chosenPools=sortPools(chosenPools).slice(0,numberOfPoolsVisible);chosenPoolsLength.current=chosenPools.length;var cardLayout=/*#__PURE__*/_jsx(CardLayout,{children:chosenPools.map(function(pool){return pool.isAutoVault?/*#__PURE__*/_jsx(CakeVaultCard,{pool:pool,showStakedOnly:stakedOnly},\"auto-cake\"):/*#__PURE__*/_jsx(PoolCard,{pool:pool,account:account},pool.sousId);})});var tableLayout=/*#__PURE__*/_jsx(PoolsTable,{pools:chosenPools,account:account,userDataLoaded:userDataLoaded});return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(PageHeader,{children:/*#__PURE__*/_jsxs(Flex,{justifyContent:\"space-between\",flexDirection:['column',null,null,'row'],children:[/*#__PURE__*/_jsxs(Flex,{flex:\"1\",flexDirection:\"column\",mr:['8px',0],children:[/*#__PURE__*/_jsx(Heading,{as:\"h1\",scale:\"xxl\",color:\"secondary\",mb:\"24px\",children:t('Syrup Pools')}),/*#__PURE__*/_jsx(Heading,{scale:\"md\",color:\"text\",children:t('Just stake some tokens to earn.')}),/*#__PURE__*/_jsx(Heading,{scale:\"md\",color:\"text\",children:t('High APR, low risk.')})]}),/*#__PURE__*/_jsxs(Flex,{flex:\"1\",height:\"fit-content\",justifyContent:\"center\",alignItems:\"center\",mt:['24px',null,'0'],children:[/*#__PURE__*/_jsx(HelpButton,{}),/*#__PURE__*/_jsx(BountyCard,{})]})]})}),/*#__PURE__*/_jsxs(Page,{children:[/*#__PURE__*/_jsxs(PoolControls,{children:[/*#__PURE__*/_jsx(PoolTabButtons,{stakedOnly:stakedOnly,setStakedOnly:setStakedOnly,hasStakeInFinishedPools:hasStakeInFinishedPools,viewMode:viewMode,setViewMode:setViewMode}),/*#__PURE__*/_jsxs(FilterContainer,{children:[/*#__PURE__*/_jsxs(LabelWrapper,{children:[/*#__PURE__*/_jsx(Text,{fontSize:\"12px\",bold:true,color:\"textSubtle\",textTransform:\"uppercase\",children:t('Sort by')}),/*#__PURE__*/_jsx(ControlStretch,{children:/*#__PURE__*/_jsx(Select,{options:[{label:t('Hot'),value:'hot'},{label:t('APR'),value:'apr'},{label:t('Earned'),value:'earned'},{label:t('Total staked'),value:'totalStaked'}],onChange:handleSortOptionChange})})]}),/*#__PURE__*/_jsxs(LabelWrapper,{style:{marginLeft:16},children:[/*#__PURE__*/_jsx(Text,{fontSize:\"12px\",bold:true,color:\"textSubtle\",textTransform:\"uppercase\",children:t('Search')}),/*#__PURE__*/_jsx(SearchInput,{onChange:handleChangeSearchQuery,placeholder:\"Search Pools\"})]})]})]}),showFinishedPools&&/*#__PURE__*/_jsx(Text,{fontSize:\"20px\",color:\"failure\",pb:\"32px\",children:t('These pools are no longer distributing rewards. Please unstake your tokens.')}),account&&!userDataLoaded&&stakedOnly&&/*#__PURE__*/_jsx(Flex,{justifyContent:\"center\",mb:\"4px\",children:/*#__PURE__*/_jsx(Loading,{})}),viewMode===ViewMode.CARD?cardLayout:tableLayout,/*#__PURE__*/_jsx(\"div\",{ref:loadMoreRef}),/*#__PURE__*/_jsx(Image,{mx:\"auto\",mt:\"12px\",src:\"/images/decorations/3d-syrup-bunnies.png\",alt:\"Pancake illustration\",width:192,height:184.5})]})]});};export default Pools;","map":{"version":3,"sources":["/Users/nguyenvanhuan243/Documents/apphocvienstock/src/views/Pools/index.tsx"],"names":["React","useEffect","useMemo","useRef","useState","useLocation","styled","BigNumber","useWeb3React","Heading","Flex","Image","Text","orderBy","partition","useTranslation","usePersistState","useFetchPublicPoolsData","usePools","useFetchCakeVault","useCakeVault","usePollFarmsData","latinise","FlexLayout","Page","PageHeader","SearchInput","Select","Loading","PoolCard","CakeVaultCard","PoolTabButtons","BountyCard","HelpButton","PoolsTable","ViewMode","getAprData","getCakeVaultEarnings","CardLayout","PoolControls","div","theme","mediaQueries","sm","FilterContainer","LabelWrapper","ControlStretch","NUMBER_OF_POOLS_VISIBLE","Pools","location","t","account","poolsWithoutAutoVault","pools","userDataLoaded","localStorageKey","stakedOnly","setStakedOnly","numberOfPoolsVisible","setNumberOfPoolsVisible","observerIsSet","setObserverIsSet","loadMoreRef","TABLE","viewMode","setViewMode","searchQuery","setSearchQuery","sortOption","setSortOption","chosenPoolsLength","userData","cakeAtLastUserAction","userShares","performanceFee","fees","pricePerFullShare","totalCakeInVault","accountHasVaultShares","gt","performanceFeeAsDecimal","cakePool","find","pool","sousId","cakeAutoVault","isAutoVault","isFinished","finishedPools","openPools","stakedOnlyFinishedPools","filter","stakedBalance","isGreaterThan","stakedOnlyOpenPools","hasStakeInFinishedPools","length","showMorePools","entries","entry","isIntersecting","poolsCurrentlyVisible","current","loadMoreObserver","IntersectionObserver","rootMargin","threshold","observe","showFinishedPools","pathname","includes","handleChangeSearchQuery","event","target","value","handleSortOptionChange","option","sortPools","poolsToSort","apr","earningTokenPrice","autoUsdToDisplay","pendingReward","times","toNumber","totalStaked","chosenPools","lowercaseQuery","toLowerCase","earningToken","symbol","slice","cardLayout","map","tableLayout","label","marginLeft","CARD"],"mappings":"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","sourcesContent":["import React, { useEffect, useMemo, useRef, useState } from 'react'\nimport { useLocation } from 'react-router-dom'\nimport styled from 'styled-components'\nimport BigNumber from 'bignumber.js'\nimport { useWeb3React } from '@web3-react/core'\nimport { Heading, Flex, Image, Text } from '@pancakeswap/uikit'\nimport orderBy from 'lodash/orderBy'\nimport partition from 'lodash/partition'\nimport { useTranslation } from 'contexts/Localization'\nimport usePersistState from 'hooks/usePersistState'\nimport { useFetchPublicPoolsData, usePools, useFetchCakeVault, useCakeVault } from 'state/pools/hooks'\nimport { usePollFarmsData } from 'state/farms/hooks'\nimport { latinise } from 'utils/latinise'\nimport FlexLayout from 'components/Layout/Flex'\nimport Page from 'components/Layout/Page'\nimport PageHeader from 'components/PageHeader'\nimport SearchInput from 'components/SearchInput'\nimport Select, { OptionProps } from 'components/Select/Select'\nimport { Pool } from 'state/types'\nimport Loading from 'components/Loading'\nimport PoolCard from './components/PoolCard'\nimport CakeVaultCard from './components/CakeVaultCard'\nimport PoolTabButtons from './components/PoolTabButtons'\nimport BountyCard from './components/BountyCard'\nimport HelpButton from './components/HelpButton'\nimport PoolsTable from './components/PoolsTable/PoolsTable'\nimport { ViewMode } from './components/ToggleView/ToggleView'\nimport { getAprData, getCakeVaultEarnings } from './helpers'\n\nconst CardLayout = styled(FlexLayout)`\n  justify-content: center;\n`\n\nconst PoolControls = styled.div`\n  display: flex;\n  width: 100%;\n  align-items: center;\n  position: relative;\n\n  justify-content: space-between;\n  flex-direction: column;\n  margin-bottom: 32px;\n\n  ${({ theme }) => theme.mediaQueries.sm} {\n    flex-direction: row;\n    flex-wrap: wrap;\n    padding: 16px 32px;\n    margin-bottom: 0;\n  }\n`\n\nconst FilterContainer = styled.div`\n  display: flex;\n  align-items: center;\n  width: 100%;\n  padding: 8px 0px;\n\n  ${({ theme }) => theme.mediaQueries.sm} {\n    width: auto;\n    padding: 0;\n  }\n`\n\nconst LabelWrapper = styled.div`\n  > ${Text} {\n    font-size: 12px;\n  }\n`\n\nconst ControlStretch = styled(Flex)`\n  > div {\n    flex: 1;\n  }\n`\n\nconst NUMBER_OF_POOLS_VISIBLE = 12\n\nconst Pools: React.FC = () => {\n  const location = useLocation()\n  const { t } = useTranslation()\n  const { account } = useWeb3React()\n  const { pools: poolsWithoutAutoVault, userDataLoaded } = usePools(account)\n  const [stakedOnly, setStakedOnly] = usePersistState(false, { localStorageKey: 'pancake_pool_staked' })\n  const [numberOfPoolsVisible, setNumberOfPoolsVisible] = useState(NUMBER_OF_POOLS_VISIBLE)\n  const [observerIsSet, setObserverIsSet] = useState(false)\n  const loadMoreRef = useRef<HTMLDivElement>(null)\n  const [viewMode, setViewMode] = usePersistState(ViewMode.TABLE, { localStorageKey: 'pancake_pool_view' })\n  const [searchQuery, setSearchQuery] = useState('')\n  const [sortOption, setSortOption] = useState('hot')\n  const chosenPoolsLength = useRef(0)\n  const {\n    userData: { cakeAtLastUserAction, userShares },\n    fees: { performanceFee },\n    pricePerFullShare,\n    totalCakeInVault,\n  } = useCakeVault()\n  const accountHasVaultShares = userShares && userShares.gt(0)\n  const performanceFeeAsDecimal = performanceFee && performanceFee / 100\n\n  const pools = useMemo(() => {\n    const cakePool = poolsWithoutAutoVault.find((pool) => pool.sousId === 0)\n    const cakeAutoVault = { ...cakePool, isAutoVault: true }\n    return [cakeAutoVault, ...poolsWithoutAutoVault]\n  }, [poolsWithoutAutoVault])\n\n  // TODO aren't arrays in dep array checked just by reference, i.e. it will rerender every time reference changes?\n  const [finishedPools, openPools] = useMemo(() => partition(pools, (pool) => pool.isFinished), [pools])\n  const stakedOnlyFinishedPools = useMemo(\n    () =>\n      finishedPools.filter((pool) => {\n        if (pool.isAutoVault) {\n          return accountHasVaultShares\n        }\n        return pool.userData && new BigNumber(pool.userData.stakedBalance).isGreaterThan(0)\n      }),\n    [finishedPools, accountHasVaultShares],\n  )\n  const stakedOnlyOpenPools = useMemo(\n    () =>\n      openPools.filter((pool) => {\n        if (pool.isAutoVault) {\n          return accountHasVaultShares\n        }\n        return pool.userData && new BigNumber(pool.userData.stakedBalance).isGreaterThan(0)\n      }),\n    [openPools, accountHasVaultShares],\n  )\n  const hasStakeInFinishedPools = stakedOnlyFinishedPools.length > 0\n\n  usePollFarmsData()\n  useFetchCakeVault()\n  useFetchPublicPoolsData()\n\n  useEffect(() => {\n    const showMorePools = (entries) => {\n      const [entry] = entries\n      if (entry.isIntersecting) {\n        setNumberOfPoolsVisible((poolsCurrentlyVisible) => {\n          if (poolsCurrentlyVisible <= chosenPoolsLength.current) {\n            return poolsCurrentlyVisible + NUMBER_OF_POOLS_VISIBLE\n          }\n          return poolsCurrentlyVisible\n        })\n      }\n    }\n\n    if (!observerIsSet) {\n      const loadMoreObserver = new IntersectionObserver(showMorePools, {\n        rootMargin: '0px',\n        threshold: 1,\n      })\n      loadMoreObserver.observe(loadMoreRef.current)\n      setObserverIsSet(true)\n    }\n  }, [observerIsSet])\n\n  const showFinishedPools = location.pathname.includes('history')\n\n  const handleChangeSearchQuery = (event: React.ChangeEvent<HTMLInputElement>) => {\n    setSearchQuery(event.target.value)\n  }\n\n  const handleSortOptionChange = (option: OptionProps): void => {\n    setSortOption(option.value)\n  }\n\n  const sortPools = (poolsToSort: Pool[]) => {\n    switch (sortOption) {\n      case 'apr':\n        // Ternary is needed to prevent pools without APR (like MIX) getting top spot\n        return orderBy(\n          poolsToSort,\n          (pool: Pool) => (pool.apr ? getAprData(pool, performanceFeeAsDecimal).apr : 0),\n          'desc',\n        )\n      case 'earned':\n        return orderBy(\n          poolsToSort,\n          (pool: Pool) => {\n            if (!pool.userData || !pool.earningTokenPrice) {\n              return 0\n            }\n            return pool.isAutoVault\n              ? getCakeVaultEarnings(\n                  account,\n                  cakeAtLastUserAction,\n                  userShares,\n                  pricePerFullShare,\n                  pool.earningTokenPrice,\n                ).autoUsdToDisplay\n              : pool.userData.pendingReward.times(pool.earningTokenPrice).toNumber()\n          },\n          'desc',\n        )\n      case 'totalStaked':\n        return orderBy(\n          poolsToSort,\n          (pool: Pool) => (pool.isAutoVault ? totalCakeInVault.toNumber() : pool.totalStaked.toNumber()),\n          'desc',\n        )\n      default:\n        return poolsToSort\n    }\n  }\n\n  let chosenPools\n  if (showFinishedPools) {\n    chosenPools = stakedOnly ? stakedOnlyFinishedPools : finishedPools\n  } else {\n    chosenPools = stakedOnly ? stakedOnlyOpenPools : openPools\n  }\n\n  if (searchQuery) {\n    const lowercaseQuery = latinise(searchQuery.toLowerCase())\n    chosenPools = chosenPools.filter((pool) =>\n      latinise(pool.earningToken.symbol.toLowerCase()).includes(lowercaseQuery),\n    )\n  }\n\n  chosenPools = sortPools(chosenPools).slice(0, numberOfPoolsVisible)\n  chosenPoolsLength.current = chosenPools.length\n\n  const cardLayout = (\n    <CardLayout>\n      {chosenPools.map((pool) =>\n        pool.isAutoVault ? (\n          <CakeVaultCard key=\"auto-cake\" pool={pool} showStakedOnly={stakedOnly} />\n        ) : (\n          <PoolCard key={pool.sousId} pool={pool} account={account} />\n        ),\n      )}\n    </CardLayout>\n  )\n\n  const tableLayout = <PoolsTable pools={chosenPools} account={account} userDataLoaded={userDataLoaded} />\n\n  return (\n    <>\n      <PageHeader>\n        <Flex justifyContent=\"space-between\" flexDirection={['column', null, null, 'row']}>\n          <Flex flex=\"1\" flexDirection=\"column\" mr={['8px', 0]}>\n            <Heading as=\"h1\" scale=\"xxl\" color=\"secondary\" mb=\"24px\">\n              {t('Syrup Pools')}\n            </Heading>\n            <Heading scale=\"md\" color=\"text\">\n              {t('Just stake some tokens to earn.')}\n            </Heading>\n            <Heading scale=\"md\" color=\"text\">\n              {t('High APR, low risk.')}\n            </Heading>\n          </Flex>\n          <Flex flex=\"1\" height=\"fit-content\" justifyContent=\"center\" alignItems=\"center\" mt={['24px', null, '0']}>\n            <HelpButton />\n            <BountyCard />\n          </Flex>\n        </Flex>\n      </PageHeader>\n      <Page>\n        <PoolControls>\n          <PoolTabButtons\n            stakedOnly={stakedOnly}\n            setStakedOnly={setStakedOnly}\n            hasStakeInFinishedPools={hasStakeInFinishedPools}\n            viewMode={viewMode}\n            setViewMode={setViewMode}\n          />\n          <FilterContainer>\n            <LabelWrapper>\n              <Text fontSize=\"12px\" bold color=\"textSubtle\" textTransform=\"uppercase\">\n                {t('Sort by')}\n              </Text>\n              <ControlStretch>\n                <Select\n                  options={[\n                    {\n                      label: t('Hot'),\n                      value: 'hot',\n                    },\n                    {\n                      label: t('APR'),\n                      value: 'apr',\n                    },\n                    {\n                      label: t('Earned'),\n                      value: 'earned',\n                    },\n                    {\n                      label: t('Total staked'),\n                      value: 'totalStaked',\n                    },\n                  ]}\n                  onChange={handleSortOptionChange}\n                />\n              </ControlStretch>\n            </LabelWrapper>\n            <LabelWrapper style={{ marginLeft: 16 }}>\n              <Text fontSize=\"12px\" bold color=\"textSubtle\" textTransform=\"uppercase\">\n                {t('Search')}\n              </Text>\n              <SearchInput onChange={handleChangeSearchQuery} placeholder=\"Search Pools\" />\n            </LabelWrapper>\n          </FilterContainer>\n        </PoolControls>\n        {showFinishedPools && (\n          <Text fontSize=\"20px\" color=\"failure\" pb=\"32px\">\n            {t('These pools are no longer distributing rewards. Please unstake your tokens.')}\n          </Text>\n        )}\n        {account && !userDataLoaded && stakedOnly && (\n          <Flex justifyContent=\"center\" mb=\"4px\">\n            <Loading />\n          </Flex>\n        )}\n        {viewMode === ViewMode.CARD ? cardLayout : tableLayout}\n        <div ref={loadMoreRef} />\n        <Image\n          mx=\"auto\"\n          mt=\"12px\"\n          src=\"/images/decorations/3d-syrup-bunnies.png\"\n          alt=\"Pancake illustration\"\n          width={192}\n          height={184.5}\n        />\n      </Page>\n    </>\n  )\n}\n\nexport default Pools\n"]},"metadata":{},"sourceType":"module"}