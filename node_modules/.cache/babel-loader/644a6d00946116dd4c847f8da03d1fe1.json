{"ast":null,"code":"import _objectSpread from\"/Users/nguyenvanhuan243/Documents/apphocvienstock/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/Users/nguyenvanhuan243/Documents/apphocvienstock/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/nguyenvanhuan243/Documents/apphocvienstock/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";/* eslint-disable no-param-reassign */import{createAsyncThunk,createSlice}from'@reduxjs/toolkit';import{LotteryStatus}from'config/constants/types';import{fetchLottery,fetchCurrentLotteryIdAndMaxBuy}from'./helpers';import getLotteriesData from'./getLotteriesData';import getUserLotteryData from'./getUserLotteryData';var initialState={currentLotteryId:null,isTransitioning:false,maxNumberTicketsPerBuyOrClaim:null,currentRound:{isLoading:true,lotteryId:null,status:LotteryStatus.PENDING,startTime:'',endTime:'',priceTicketInCake:'',discountDivisor:'',treasuryFee:'',firstTicketId:'',lastTicketId:'',amountCollectedInCake:'',finalNumber:null,cakePerBracket:[],countWinnersPerBracket:[],rewardsBreakdown:[],userTickets:{isLoading:true,tickets:[]}},lotteriesData:null,userLotteryData:{account:'',totalCake:'',totalTickets:'',rounds:[]}};export var fetchCurrentLottery=createAsyncThunk('lottery/fetchCurrentLottery',/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref){var currentLotteryId,lotteryInfo;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:currentLotteryId=_ref.currentLotteryId;_context.next=3;return fetchLottery(currentLotteryId);case 3:lotteryInfo=_context.sent;return _context.abrupt(\"return\",lotteryInfo);case 5:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}());export var fetchCurrentLotteryId=createAsyncThunk('lottery/fetchCurrentLotteryId',/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var currentIdAndMaxBuy;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return fetchCurrentLotteryIdAndMaxBuy();case 2:currentIdAndMaxBuy=_context2.sent;return _context2.abrupt(\"return\",currentIdAndMaxBuy);case 4:case\"end\":return _context2.stop();}}},_callee2);})));export var fetchUserTicketsAndLotteries=createAsyncThunk('lottery/fetchUserTicketsAndLotteries',/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(_ref4){var _userLotteriesRes$rou;var account,currentLotteryId,userLotteriesRes,userParticipationInCurrentRound,userTickets;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:account=_ref4.account,currentLotteryId=_ref4.currentLotteryId;_context3.next=3;return getUserLotteryData(account,currentLotteryId);case 3:userLotteriesRes=_context3.sent;userParticipationInCurrentRound=(_userLotteriesRes$rou=userLotteriesRes.rounds)===null||_userLotteriesRes$rou===void 0?void 0:_userLotteriesRes$rou.find(function(round){return round.lotteryId===currentLotteryId;});userTickets=userParticipationInCurrentRound===null||userParticipationInCurrentRound===void 0?void 0:userParticipationInCurrentRound.tickets;// User has not bought tickets for the current lottery, or there has been an error\nif(!(!userTickets||userTickets.length===0)){_context3.next=8;break;}return _context3.abrupt(\"return\",{userTickets:null,userLotteries:userLotteriesRes});case 8:return _context3.abrupt(\"return\",{userTickets:userTickets,userLotteries:userLotteriesRes});case 9:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x2){return _ref5.apply(this,arguments);};}());export var fetchPublicLotteries=createAsyncThunk('lottery/fetchPublicLotteries',/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(_ref6){var currentLotteryId,lotteries;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:currentLotteryId=_ref6.currentLotteryId;_context4.next=3;return getLotteriesData(currentLotteryId);case 3:lotteries=_context4.sent;return _context4.abrupt(\"return\",lotteries);case 5:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x3){return _ref7.apply(this,arguments);};}());export var fetchUserLotteries=createAsyncThunk('lottery/fetchUserLotteries',/*#__PURE__*/function(){var _ref9=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(_ref8){var account,currentLotteryId,userLotteries;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:account=_ref8.account,currentLotteryId=_ref8.currentLotteryId;_context5.next=3;return getUserLotteryData(account,currentLotteryId);case 3:userLotteries=_context5.sent;return _context5.abrupt(\"return\",userLotteries);case 5:case\"end\":return _context5.stop();}}},_callee5);}));return function(_x4){return _ref9.apply(this,arguments);};}());export var setLotteryIsTransitioning=createAsyncThunk(\"lottery/setIsTransitioning\",/*#__PURE__*/function(){var _ref11=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(_ref10){var isTransitioning;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:isTransitioning=_ref10.isTransitioning;return _context6.abrupt(\"return\",{isTransitioning:isTransitioning});case 2:case\"end\":return _context6.stop();}}},_callee6);}));return function(_x5){return _ref11.apply(this,arguments);};}());export var LotterySlice=createSlice({name:'Lottery',initialState:initialState,reducers:{setLotteryPublicData:function setLotteryPublicData(state,action){state=action.payload;}},extraReducers:function extraReducers(builder){builder.addCase(fetchCurrentLottery.fulfilled,function(state,action){state.currentRound=_objectSpread(_objectSpread({},state.currentRound),action.payload);});builder.addCase(fetchCurrentLotteryId.fulfilled,function(state,action){state.currentLotteryId=action.payload.currentLotteryId;state.maxNumberTicketsPerBuyOrClaim=action.payload.maxNumberTicketsPerBuyOrClaim;});builder.addCase(fetchUserTicketsAndLotteries.fulfilled,function(state,action){state.currentRound.userTickets.isLoading=false;state.currentRound.userTickets.tickets=action.payload.userTickets;state.userLotteryData=action.payload.userLotteries;});builder.addCase(fetchPublicLotteries.fulfilled,function(state,action){state.lotteriesData=action.payload;});builder.addCase(fetchUserLotteries.fulfilled,function(state,action){state.userLotteryData=action.payload;});builder.addCase(setLotteryIsTransitioning.fulfilled,function(state,action){state.isTransitioning=action.payload.isTransitioning;});}});// Actions\nvar setLotteryPublicData=LotterySlice.actions.setLotteryPublicData;export{setLotteryPublicData};export default LotterySlice.reducer;","map":{"version":3,"sources":["/Users/nguyenvanhuan243/Documents/apphocvienstock/src/state/lottery/index.ts"],"names":["createAsyncThunk","createSlice","LotteryStatus","fetchLottery","fetchCurrentLotteryIdAndMaxBuy","getLotteriesData","getUserLotteryData","initialState","currentLotteryId","isTransitioning","maxNumberTicketsPerBuyOrClaim","currentRound","isLoading","lotteryId","status","PENDING","startTime","endTime","priceTicketInCake","discountDivisor","treasuryFee","firstTicketId","lastTicketId","amountCollectedInCake","finalNumber","cakePerBracket","countWinnersPerBracket","rewardsBreakdown","userTickets","tickets","lotteriesData","userLotteryData","account","totalCake","totalTickets","rounds","fetchCurrentLottery","lotteryInfo","fetchCurrentLotteryId","currentIdAndMaxBuy","fetchUserTicketsAndLotteries","userLotteriesRes","userParticipationInCurrentRound","find","round","length","userLotteries","fetchPublicLotteries","lotteries","fetchUserLotteries","setLotteryIsTransitioning","LotterySlice","name","reducers","setLotteryPublicData","state","action","payload","extraReducers","builder","addCase","fulfilled","actions","reducer"],"mappings":"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","sourcesContent":["/* eslint-disable no-param-reassign */\nimport { createAsyncThunk, createSlice, PayloadAction } from '@reduxjs/toolkit'\nimport { LotteryTicket, LotteryStatus } from 'config/constants/types'\nimport { LotteryState, LotteryRoundGraphEntity, LotteryUserGraphEntity, LotteryResponse } from 'state/types'\nimport { fetchLottery, fetchCurrentLotteryIdAndMaxBuy } from './helpers'\nimport getLotteriesData from './getLotteriesData'\nimport getUserLotteryData from './getUserLotteryData'\n\ninterface PublicLotteryData {\n  currentLotteryId: string\n  maxNumberTicketsPerBuyOrClaim: string\n}\n\nconst initialState: LotteryState = {\n  currentLotteryId: null,\n  isTransitioning: false,\n  maxNumberTicketsPerBuyOrClaim: null,\n  currentRound: {\n    isLoading: true,\n    lotteryId: null,\n    status: LotteryStatus.PENDING,\n    startTime: '',\n    endTime: '',\n    priceTicketInCake: '',\n    discountDivisor: '',\n    treasuryFee: '',\n    firstTicketId: '',\n    lastTicketId: '',\n    amountCollectedInCake: '',\n    finalNumber: null,\n    cakePerBracket: [],\n    countWinnersPerBracket: [],\n    rewardsBreakdown: [],\n    userTickets: {\n      isLoading: true,\n      tickets: [],\n    },\n  },\n  lotteriesData: null,\n  userLotteryData: { account: '', totalCake: '', totalTickets: '', rounds: [] },\n}\n\nexport const fetchCurrentLottery = createAsyncThunk<LotteryResponse, { currentLotteryId: string }>(\n  'lottery/fetchCurrentLottery',\n  async ({ currentLotteryId }) => {\n    const lotteryInfo = await fetchLottery(currentLotteryId)\n    return lotteryInfo\n  },\n)\n\nexport const fetchCurrentLotteryId = createAsyncThunk<PublicLotteryData>('lottery/fetchCurrentLotteryId', async () => {\n  const currentIdAndMaxBuy = await fetchCurrentLotteryIdAndMaxBuy()\n  return currentIdAndMaxBuy\n})\n\nexport const fetchUserTicketsAndLotteries = createAsyncThunk<\n  { userTickets: LotteryTicket[]; userLotteries: LotteryUserGraphEntity },\n  { account: string; currentLotteryId: string }\n>('lottery/fetchUserTicketsAndLotteries', async ({ account, currentLotteryId }) => {\n  const userLotteriesRes = await getUserLotteryData(account, currentLotteryId)\n  const userParticipationInCurrentRound = userLotteriesRes.rounds?.find((round) => round.lotteryId === currentLotteryId)\n  const userTickets = userParticipationInCurrentRound?.tickets\n\n  // User has not bought tickets for the current lottery, or there has been an error\n  if (!userTickets || userTickets.length === 0) {\n    return { userTickets: null, userLotteries: userLotteriesRes }\n  }\n\n  return { userTickets, userLotteries: userLotteriesRes }\n})\n\nexport const fetchPublicLotteries = createAsyncThunk<LotteryRoundGraphEntity[], { currentLotteryId: string }>(\n  'lottery/fetchPublicLotteries',\n  async ({ currentLotteryId }) => {\n    const lotteries = await getLotteriesData(currentLotteryId)\n    return lotteries\n  },\n)\n\nexport const fetchUserLotteries = createAsyncThunk<\n  LotteryUserGraphEntity,\n  { account: string; currentLotteryId: string }\n>('lottery/fetchUserLotteries', async ({ account, currentLotteryId }) => {\n  const userLotteries = await getUserLotteryData(account, currentLotteryId)\n  return userLotteries\n})\n\nexport const setLotteryIsTransitioning = createAsyncThunk<{ isTransitioning: boolean }, { isTransitioning: boolean }>(\n  `lottery/setIsTransitioning`,\n  async ({ isTransitioning }) => {\n    return { isTransitioning }\n  },\n)\n\nexport const LotterySlice = createSlice({\n  name: 'Lottery',\n  initialState,\n  reducers: {\n    setLotteryPublicData: (state, action) => {\n      state = action.payload\n    },\n  },\n  extraReducers: (builder) => {\n    builder.addCase(fetchCurrentLottery.fulfilled, (state, action: PayloadAction<LotteryResponse>) => {\n      state.currentRound = { ...state.currentRound, ...action.payload }\n    })\n    builder.addCase(fetchCurrentLotteryId.fulfilled, (state, action: PayloadAction<PublicLotteryData>) => {\n      state.currentLotteryId = action.payload.currentLotteryId\n      state.maxNumberTicketsPerBuyOrClaim = action.payload.maxNumberTicketsPerBuyOrClaim\n    })\n    builder.addCase(\n      fetchUserTicketsAndLotteries.fulfilled,\n      (state, action: PayloadAction<{ userTickets: LotteryTicket[]; userLotteries: LotteryUserGraphEntity }>) => {\n        state.currentRound.userTickets.isLoading = false\n        state.currentRound.userTickets.tickets = action.payload.userTickets\n        state.userLotteryData = action.payload.userLotteries\n      },\n    )\n    builder.addCase(fetchPublicLotteries.fulfilled, (state, action: PayloadAction<LotteryRoundGraphEntity[]>) => {\n      state.lotteriesData = action.payload\n    })\n    builder.addCase(fetchUserLotteries.fulfilled, (state, action: PayloadAction<LotteryUserGraphEntity>) => {\n      state.userLotteryData = action.payload\n    })\n    builder.addCase(\n      setLotteryIsTransitioning.fulfilled,\n      (state, action: PayloadAction<{ isTransitioning: boolean }>) => {\n        state.isTransitioning = action.payload.isTransitioning\n      },\n    )\n  },\n})\n\n// Actions\nexport const { setLotteryPublicData } = LotterySlice.actions\n\nexport default LotterySlice.reducer\n"]},"metadata":{},"sourceType":"module"}