{"ast":null,"code":"import _regeneratorRuntime from\"/Users/nguyenvanhuan243/Documents/apphocvienstock/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/nguyenvanhuan243/Documents/apphocvienstock/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/nguyenvanhuan243/Documents/apphocvienstock/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/Users/nguyenvanhuan243/Documents/apphocvienstock/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";var _templateObject,_templateObject2,_templateObject3;import React,{useEffect,useState}from'react';import styled from'styled-components';import{Modal,Text,Flex,Image,Button,Slider,BalanceInput,AutoRenewIcon,Link,CalculateIcon,IconButton}from'@pancakeswap/uikit';import{useTranslation}from'contexts/Localization';import useTheme from'hooks/useTheme';import useToast from'hooks/useToast';import BigNumber from'bignumber.js';import RoiCalculatorModal from'components/RoiCalculatorModal';import{getFullDisplayBalance,formatNumber,getDecimalAmount}from'utils/formatBalance';import{getAddress}from'utils/addressHelpers';import{getInterestBreakdown}from'utils/compoundApyHelpers';import PercentageButton from'./PercentageButton';import useStakePool from'../../../hooks/useStakePool';import useUnstakePool from'../../../hooks/useUnstakePool';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var StyledLink=styled(Link)(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  width: 100%;\\n\"])));var AnnualRoiContainer=styled(Flex)(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  cursor: pointer;\\n\"])));var AnnualRoiDisplay=styled(Text)(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  width: 72px;\\n  max-width: 72px;\\n  overflow: hidden;\\n  text-align: right;\\n  text-overflow: ellipsis;\\n\"])));var StakeModal=function StakeModal(_ref){var isBnbPool=_ref.isBnbPool,pool=_ref.pool,stakingTokenBalance=_ref.stakingTokenBalance,stakingTokenPrice=_ref.stakingTokenPrice,_ref$isRemovingStake=_ref.isRemovingStake,isRemovingStake=_ref$isRemovingStake===void 0?false:_ref$isRemovingStake,onDismiss=_ref.onDismiss;var sousId=pool.sousId,stakingToken=pool.stakingToken,earningTokenPrice=pool.earningTokenPrice,apr=pool.apr,userData=pool.userData,stakingLimit=pool.stakingLimit,earningToken=pool.earningToken;var _useTranslation=useTranslation(),t=_useTranslation.t;var _useTheme=useTheme(),theme=_useTheme.theme;var _useStakePool=useStakePool(sousId,isBnbPool),onStake=_useStakePool.onStake;var _useUnstakePool=useUnstakePool(sousId,pool.enableEmergencyWithdraw),onUnstake=_useUnstakePool.onUnstake;var _useToast=useToast(),toastSuccess=_useToast.toastSuccess,toastError=_useToast.toastError;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),pendingTx=_useState2[0],setPendingTx=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),stakeAmount=_useState4[0],setStakeAmount=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),hasReachedStakeLimit=_useState6[0],setHasReachedStakedLimit=_useState6[1];var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),percent=_useState8[0],setPercent=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),showRoiCalculator=_useState10[0],setShowRoiCalculator=_useState10[1];var getCalculatedStakingLimit=function getCalculatedStakingLimit(){if(isRemovingStake){return userData.stakedBalance;}return stakingLimit.gt(0)&&stakingTokenBalance.gt(stakingLimit)?stakingLimit:stakingTokenBalance;};var usdValueStaked=new BigNumber(stakeAmount).times(stakingTokenPrice);var formattedUsdValueStaked=!usdValueStaked.isNaN()&&formatNumber(usdValueStaked.toNumber());var interestBreakdown=getInterestBreakdown({principalInUSD:!usdValueStaked.isNaN()?usdValueStaked.toNumber():0,apr:apr,earningTokenPrice:earningTokenPrice});var annualRoi=interestBreakdown[3]*pool.earningTokenPrice;var formattedAnnualRoi=formatNumber(annualRoi,annualRoi>10000?0:2,annualRoi>10000?0:2);var getTokenLink=stakingToken.address?\"/swap?outputCurrency=\".concat(getAddress(stakingToken.address)):'/swap';useEffect(function(){if(stakingLimit.gt(0)&&!isRemovingStake){var fullDecimalStakeAmount=getDecimalAmount(new BigNumber(stakeAmount),stakingToken.decimals);setHasReachedStakedLimit(fullDecimalStakeAmount.plus(userData.stakedBalance).gt(stakingLimit));}},[stakeAmount,stakingLimit,userData,stakingToken,isRemovingStake,setHasReachedStakedLimit]);var handleStakeInputChange=function handleStakeInputChange(input){if(input){var convertedInput=getDecimalAmount(new BigNumber(input),stakingToken.decimals);var percentage=Math.floor(convertedInput.dividedBy(getCalculatedStakingLimit()).multipliedBy(100).toNumber());setPercent(Math.min(percentage,100));}else{setPercent(0);}setStakeAmount(input);};var handleChangePercent=function handleChangePercent(sliderPercent){if(sliderPercent>0){var percentageOfStakingMax=getCalculatedStakingLimit().dividedBy(100).multipliedBy(sliderPercent);var amountToStake=getFullDisplayBalance(percentageOfStakingMax,stakingToken.decimals,stakingToken.decimals);setStakeAmount(amountToStake);}else{setStakeAmount('');}setPercent(sliderPercent);};var handleConfirmClick=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setPendingTx(true);if(!isRemovingStake){_context.next=16;break;}_context.prev=2;_context.next=5;return onUnstake(stakeAmount,stakingToken.decimals);case 5:toastSuccess(\"\".concat(t('Unstaked'),\"!\"),t('Your %symbol% earnings have also been harvested to your wallet!',{symbol:earningToken.symbol}));setPendingTx(false);onDismiss();_context.next=14;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](2);toastError(t('Error'),t('Please try again. Confirm the transaction and make sure you are paying enough gas!'));setPendingTx(false);case 14:_context.next=28;break;case 16:_context.prev=16;_context.next=19;return onStake(stakeAmount,stakingToken.decimals);case 19:toastSuccess(\"\".concat(t('Staked'),\"!\"),t('Your %symbol% funds have been staked in the pool!',{symbol:stakingToken.symbol}));setPendingTx(false);onDismiss();_context.next=28;break;case 24:_context.prev=24;_context.t1=_context[\"catch\"](16);toastError(t('Error'),t('Please try again. Confirm the transaction and make sure you are paying enough gas!'));setPendingTx(false);case 28:case\"end\":return _context.stop();}}},_callee,null,[[2,10],[16,24]]);}));return function handleConfirmClick(){return _ref2.apply(this,arguments);};}();if(showRoiCalculator){return/*#__PURE__*/_jsx(RoiCalculatorModal,{earningTokenPrice:earningTokenPrice,stakingTokenPrice:stakingTokenPrice,apr:apr,linkLabel:t('Get %symbol%',{symbol:stakingToken.symbol}),linkHref:getTokenLink,stakingTokenBalance:userData.stakedBalance.plus(stakingTokenBalance),stakingTokenSymbol:stakingToken.symbol,earningTokenSymbol:earningToken.symbol,onBack:function onBack(){return setShowRoiCalculator(false);},initialValue:stakeAmount});}return/*#__PURE__*/_jsxs(Modal,{minWidth:\"346px\",title:isRemovingStake?t('Unstake'):t('Stake in Pool'),onDismiss:onDismiss,headerBackground:theme.colors.gradients.cardHeader,children:[stakingLimit.gt(0)&&!isRemovingStake&&/*#__PURE__*/_jsx(Text,{color:\"secondary\",bold:true,mb:\"24px\",style:{textAlign:'center'},fontSize:\"16px\",children:t('Max stake for this pool: %amount% %token%',{amount:getFullDisplayBalance(stakingLimit,stakingToken.decimals,0),token:stakingToken.symbol})}),/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",justifyContent:\"space-between\",mb:\"8px\",children:[/*#__PURE__*/_jsxs(Text,{bold:true,children:[isRemovingStake?t('Unstake'):t('Stake'),\":\"]}),/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",minWidth:\"70px\",children:[/*#__PURE__*/_jsx(Image,{src:\"/images/tokens/\".concat(getAddress(stakingToken.address),\".png\"),width:24,height:24,alt:stakingToken.symbol}),/*#__PURE__*/_jsx(Text,{ml:\"4px\",bold:true,children:stakingToken.symbol})]})]}),/*#__PURE__*/_jsx(BalanceInput,{value:stakeAmount,onUserInput:handleStakeInputChange,currencyValue:stakingTokenPrice!==0&&\"~\".concat(formattedUsdValueStaked||0,\" USD\"),isWarning:hasReachedStakeLimit,decimals:stakingToken.decimals}),hasReachedStakeLimit&&/*#__PURE__*/_jsx(Text,{color:\"failure\",fontSize:\"12px\",style:{textAlign:'right'},mt:\"4px\",children:t('Maximum total stake: %amount% %token%',{amount:getFullDisplayBalance(new BigNumber(stakingLimit),stakingToken.decimals,0),token:stakingToken.symbol})}),/*#__PURE__*/_jsx(Text,{ml:\"auto\",color:\"textSubtle\",fontSize:\"12px\",mb:\"8px\",children:t('Balance: %balance%',{balance:getFullDisplayBalance(getCalculatedStakingLimit(),stakingToken.decimals)})}),/*#__PURE__*/_jsx(Slider,{min:0,max:100,value:percent,onValueChanged:handleChangePercent,name:\"stake\",valueLabel:\"\".concat(percent,\"%\"),step:1}),/*#__PURE__*/_jsxs(Flex,{alignItems:\"center\",justifyContent:\"space-between\",mt:\"8px\",children:[/*#__PURE__*/_jsx(PercentageButton,{onClick:function onClick(){return handleChangePercent(25);},children:\"25%\"}),/*#__PURE__*/_jsx(PercentageButton,{onClick:function onClick(){return handleChangePercent(50);},children:\"50%\"}),/*#__PURE__*/_jsx(PercentageButton,{onClick:function onClick(){return handleChangePercent(75);},children:\"75%\"}),/*#__PURE__*/_jsx(PercentageButton,{onClick:function onClick(){return handleChangePercent(100);},children:t('Max')})]}),!isRemovingStake&&/*#__PURE__*/_jsxs(Flex,{mt:\"24px\",alignItems:\"center\",justifyContent:\"space-between\",children:[/*#__PURE__*/_jsxs(Text,{mr:\"8px\",color:\"textSubtle\",children:[t('Annual ROI at current rates'),\":\"]}),/*#__PURE__*/_jsxs(AnnualRoiContainer,{alignItems:\"center\",onClick:function onClick(){return setShowRoiCalculator(true);},children:[/*#__PURE__*/_jsxs(AnnualRoiDisplay,{children:[\"$\",formattedAnnualRoi]}),/*#__PURE__*/_jsx(IconButton,{variant:\"text\",scale:\"sm\",children:/*#__PURE__*/_jsx(CalculateIcon,{color:\"textSubtle\",width:\"18px\"})})]})]}),/*#__PURE__*/_jsx(Button,{isLoading:pendingTx,endIcon:pendingTx?/*#__PURE__*/_jsx(AutoRenewIcon,{spin:true,color:\"currentColor\"}):null,onClick:handleConfirmClick,disabled:!stakeAmount||parseFloat(stakeAmount)===0||hasReachedStakeLimit,mt:\"24px\",children:pendingTx?t('Confirming'):t('Confirm')}),!isRemovingStake&&/*#__PURE__*/_jsx(StyledLink,{external:true,href:getTokenLink,children:/*#__PURE__*/_jsx(Button,{width:\"100%\",mt:\"8px\",variant:\"secondary\",children:t('Get %symbol%',{symbol:stakingToken.symbol})})})]});};export default StakeModal;","map":{"version":3,"sources":["/Users/nguyenvanhuan243/Documents/apphocvienstock/src/views/Pools/components/PoolCard/Modals/StakeModal.tsx"],"names":["React","useEffect","useState","styled","Modal","Text","Flex","Image","Button","Slider","BalanceInput","AutoRenewIcon","Link","CalculateIcon","IconButton","useTranslation","useTheme","useToast","BigNumber","RoiCalculatorModal","getFullDisplayBalance","formatNumber","getDecimalAmount","getAddress","getInterestBreakdown","PercentageButton","useStakePool","useUnstakePool","StyledLink","AnnualRoiContainer","AnnualRoiDisplay","StakeModal","isBnbPool","pool","stakingTokenBalance","stakingTokenPrice","isRemovingStake","onDismiss","sousId","stakingToken","earningTokenPrice","apr","userData","stakingLimit","earningToken","t","theme","onStake","enableEmergencyWithdraw","onUnstake","toastSuccess","toastError","pendingTx","setPendingTx","stakeAmount","setStakeAmount","hasReachedStakeLimit","setHasReachedStakedLimit","percent","setPercent","showRoiCalculator","setShowRoiCalculator","getCalculatedStakingLimit","stakedBalance","gt","usdValueStaked","times","formattedUsdValueStaked","isNaN","toNumber","interestBreakdown","principalInUSD","annualRoi","formattedAnnualRoi","getTokenLink","address","fullDecimalStakeAmount","decimals","plus","handleStakeInputChange","input","convertedInput","percentage","Math","floor","dividedBy","multipliedBy","min","handleChangePercent","sliderPercent","percentageOfStakingMax","amountToStake","handleConfirmClick","symbol","colors","gradients","cardHeader","textAlign","amount","token","balance","parseFloat"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react'\nimport styled from 'styled-components'\nimport {\n  Modal,\n  Text,\n  Flex,\n  Image,\n  Button,\n  Slider,\n  BalanceInput,\n  AutoRenewIcon,\n  Link,\n  CalculateIcon,\n  IconButton,\n} from '@pancakeswap/uikit'\nimport { useTranslation } from 'contexts/Localization'\nimport useTheme from 'hooks/useTheme'\nimport useToast from 'hooks/useToast'\nimport BigNumber from 'bignumber.js'\nimport RoiCalculatorModal from 'components/RoiCalculatorModal'\nimport { getFullDisplayBalance, formatNumber, getDecimalAmount } from 'utils/formatBalance'\nimport { Pool } from 'state/types'\nimport { getAddress } from 'utils/addressHelpers'\nimport { getInterestBreakdown } from 'utils/compoundApyHelpers'\nimport PercentageButton from './PercentageButton'\nimport useStakePool from '../../../hooks/useStakePool'\nimport useUnstakePool from '../../../hooks/useUnstakePool'\n\ninterface StakeModalProps {\n  isBnbPool: boolean\n  pool: Pool\n  stakingTokenBalance: BigNumber\n  stakingTokenPrice: number\n  isRemovingStake?: boolean\n  onDismiss?: () => void\n}\n\nconst StyledLink = styled(Link)`\n  width: 100%;\n`\n\nconst AnnualRoiContainer = styled(Flex)`\n  cursor: pointer;\n`\n\nconst AnnualRoiDisplay = styled(Text)`\n  width: 72px;\n  max-width: 72px;\n  overflow: hidden;\n  text-align: right;\n  text-overflow: ellipsis;\n`\n\nconst StakeModal: React.FC<StakeModalProps> = ({\n  isBnbPool,\n  pool,\n  stakingTokenBalance,\n  stakingTokenPrice,\n  isRemovingStake = false,\n  onDismiss,\n}) => {\n  const { sousId, stakingToken, earningTokenPrice, apr, userData, stakingLimit, earningToken } = pool\n  const { t } = useTranslation()\n  const { theme } = useTheme()\n  const { onStake } = useStakePool(sousId, isBnbPool)\n  const { onUnstake } = useUnstakePool(sousId, pool.enableEmergencyWithdraw)\n  const { toastSuccess, toastError } = useToast()\n  const [pendingTx, setPendingTx] = useState(false)\n  const [stakeAmount, setStakeAmount] = useState('')\n  const [hasReachedStakeLimit, setHasReachedStakedLimit] = useState(false)\n  const [percent, setPercent] = useState(0)\n  const [showRoiCalculator, setShowRoiCalculator] = useState(false)\n  const getCalculatedStakingLimit = () => {\n    if (isRemovingStake) {\n      return userData.stakedBalance\n    }\n    return stakingLimit.gt(0) && stakingTokenBalance.gt(stakingLimit) ? stakingLimit : stakingTokenBalance\n  }\n\n  const usdValueStaked = new BigNumber(stakeAmount).times(stakingTokenPrice)\n  const formattedUsdValueStaked = !usdValueStaked.isNaN() && formatNumber(usdValueStaked.toNumber())\n\n  const interestBreakdown = getInterestBreakdown({\n    principalInUSD: !usdValueStaked.isNaN() ? usdValueStaked.toNumber() : 0,\n    apr,\n    earningTokenPrice,\n  })\n  const annualRoi = interestBreakdown[3] * pool.earningTokenPrice\n  const formattedAnnualRoi = formatNumber(annualRoi, annualRoi > 10000 ? 0 : 2, annualRoi > 10000 ? 0 : 2)\n\n  const getTokenLink = stakingToken.address ? `/swap?outputCurrency=${getAddress(stakingToken.address)}` : '/swap'\n\n  useEffect(() => {\n    if (stakingLimit.gt(0) && !isRemovingStake) {\n      const fullDecimalStakeAmount = getDecimalAmount(new BigNumber(stakeAmount), stakingToken.decimals)\n      setHasReachedStakedLimit(fullDecimalStakeAmount.plus(userData.stakedBalance).gt(stakingLimit))\n    }\n  }, [stakeAmount, stakingLimit, userData, stakingToken, isRemovingStake, setHasReachedStakedLimit])\n\n  const handleStakeInputChange = (input: string) => {\n    if (input) {\n      const convertedInput = getDecimalAmount(new BigNumber(input), stakingToken.decimals)\n      const percentage = Math.floor(convertedInput.dividedBy(getCalculatedStakingLimit()).multipliedBy(100).toNumber())\n      setPercent(Math.min(percentage, 100))\n    } else {\n      setPercent(0)\n    }\n    setStakeAmount(input)\n  }\n\n  const handleChangePercent = (sliderPercent: number) => {\n    if (sliderPercent > 0) {\n      const percentageOfStakingMax = getCalculatedStakingLimit().dividedBy(100).multipliedBy(sliderPercent)\n      const amountToStake = getFullDisplayBalance(percentageOfStakingMax, stakingToken.decimals, stakingToken.decimals)\n      setStakeAmount(amountToStake)\n    } else {\n      setStakeAmount('')\n    }\n    setPercent(sliderPercent)\n  }\n\n  const handleConfirmClick = async () => {\n    setPendingTx(true)\n\n    if (isRemovingStake) {\n      // unstaking\n      try {\n        await onUnstake(stakeAmount, stakingToken.decimals)\n        toastSuccess(\n          `${t('Unstaked')}!`,\n          t('Your %symbol% earnings have also been harvested to your wallet!', {\n            symbol: earningToken.symbol,\n          }),\n        )\n        setPendingTx(false)\n        onDismiss()\n      } catch (e) {\n        toastError(t('Error'), t('Please try again. Confirm the transaction and make sure you are paying enough gas!'))\n        setPendingTx(false)\n      }\n    } else {\n      try {\n        // staking\n        await onStake(stakeAmount, stakingToken.decimals)\n        toastSuccess(\n          `${t('Staked')}!`,\n          t('Your %symbol% funds have been staked in the pool!', {\n            symbol: stakingToken.symbol,\n          }),\n        )\n        setPendingTx(false)\n        onDismiss()\n      } catch (e) {\n        toastError(t('Error'), t('Please try again. Confirm the transaction and make sure you are paying enough gas!'))\n        setPendingTx(false)\n      }\n    }\n  }\n\n  if (showRoiCalculator) {\n    return (\n      <RoiCalculatorModal\n        earningTokenPrice={earningTokenPrice}\n        stakingTokenPrice={stakingTokenPrice}\n        apr={apr}\n        linkLabel={t('Get %symbol%', { symbol: stakingToken.symbol })}\n        linkHref={getTokenLink}\n        stakingTokenBalance={userData.stakedBalance.plus(stakingTokenBalance)}\n        stakingTokenSymbol={stakingToken.symbol}\n        earningTokenSymbol={earningToken.symbol}\n        onBack={() => setShowRoiCalculator(false)}\n        initialValue={stakeAmount}\n      />\n    )\n  }\n\n  return (\n    <Modal\n      minWidth=\"346px\"\n      title={isRemovingStake ? t('Unstake') : t('Stake in Pool')}\n      onDismiss={onDismiss}\n      headerBackground={theme.colors.gradients.cardHeader}\n    >\n      {stakingLimit.gt(0) && !isRemovingStake && (\n        <Text color=\"secondary\" bold mb=\"24px\" style={{ textAlign: 'center' }} fontSize=\"16px\">\n          {t('Max stake for this pool: %amount% %token%', {\n            amount: getFullDisplayBalance(stakingLimit, stakingToken.decimals, 0),\n            token: stakingToken.symbol,\n          })}\n        </Text>\n      )}\n      <Flex alignItems=\"center\" justifyContent=\"space-between\" mb=\"8px\">\n        <Text bold>{isRemovingStake ? t('Unstake') : t('Stake')}:</Text>\n        <Flex alignItems=\"center\" minWidth=\"70px\">\n          <Image\n            src={`/images/tokens/${getAddress(stakingToken.address)}.png`}\n            width={24}\n            height={24}\n            alt={stakingToken.symbol}\n          />\n          <Text ml=\"4px\" bold>\n            {stakingToken.symbol}\n          </Text>\n        </Flex>\n      </Flex>\n      <BalanceInput\n        value={stakeAmount}\n        onUserInput={handleStakeInputChange}\n        currencyValue={stakingTokenPrice !== 0 && `~${formattedUsdValueStaked || 0} USD`}\n        isWarning={hasReachedStakeLimit}\n        decimals={stakingToken.decimals}\n      />\n      {hasReachedStakeLimit && (\n        <Text color=\"failure\" fontSize=\"12px\" style={{ textAlign: 'right' }} mt=\"4px\">\n          {t('Maximum total stake: %amount% %token%', {\n            amount: getFullDisplayBalance(new BigNumber(stakingLimit), stakingToken.decimals, 0),\n            token: stakingToken.symbol,\n          })}\n        </Text>\n      )}\n      <Text ml=\"auto\" color=\"textSubtle\" fontSize=\"12px\" mb=\"8px\">\n        {t('Balance: %balance%', {\n          balance: getFullDisplayBalance(getCalculatedStakingLimit(), stakingToken.decimals),\n        })}\n      </Text>\n      <Slider\n        min={0}\n        max={100}\n        value={percent}\n        onValueChanged={handleChangePercent}\n        name=\"stake\"\n        valueLabel={`${percent}%`}\n        step={1}\n      />\n      <Flex alignItems=\"center\" justifyContent=\"space-between\" mt=\"8px\">\n        <PercentageButton onClick={() => handleChangePercent(25)}>25%</PercentageButton>\n        <PercentageButton onClick={() => handleChangePercent(50)}>50%</PercentageButton>\n        <PercentageButton onClick={() => handleChangePercent(75)}>75%</PercentageButton>\n        <PercentageButton onClick={() => handleChangePercent(100)}>{t('Max')}</PercentageButton>\n      </Flex>\n      {!isRemovingStake && (\n        <Flex mt=\"24px\" alignItems=\"center\" justifyContent=\"space-between\">\n          <Text mr=\"8px\" color=\"textSubtle\">\n            {t('Annual ROI at current rates')}:\n          </Text>\n          <AnnualRoiContainer alignItems=\"center\" onClick={() => setShowRoiCalculator(true)}>\n            <AnnualRoiDisplay>${formattedAnnualRoi}</AnnualRoiDisplay>\n            <IconButton variant=\"text\" scale=\"sm\">\n              <CalculateIcon color=\"textSubtle\" width=\"18px\" />\n            </IconButton>\n          </AnnualRoiContainer>\n        </Flex>\n      )}\n      <Button\n        isLoading={pendingTx}\n        endIcon={pendingTx ? <AutoRenewIcon spin color=\"currentColor\" /> : null}\n        onClick={handleConfirmClick}\n        disabled={!stakeAmount || parseFloat(stakeAmount) === 0 || hasReachedStakeLimit}\n        mt=\"24px\"\n      >\n        {pendingTx ? t('Confirming') : t('Confirm')}\n      </Button>\n      {!isRemovingStake && (\n        <StyledLink external href={getTokenLink}>\n          <Button width=\"100%\" mt=\"8px\" variant=\"secondary\">\n            {t('Get %symbol%', { symbol: stakingToken.symbol })}\n          </Button>\n        </StyledLink>\n      )}\n    </Modal>\n  )\n}\n\nexport default StakeModal\n"]},"metadata":{},"sourceType":"module"}